Answer Sentence Selection (YodaQA)
==================================

In Question Answering systems on top of unstructured corpora, one task is
selecting the sentences in corpora that are most likely to carry an answer
to a given question.  In this scenario, the questions come from the
``curated-train`` YodaQA dataset and the YodaQA system generated the
candidate sentences based on enwiki, using YodaQA f/sentence-selection
branch commit a5f7f98 (based on v1.5).

Sentences were generated by running fulltext solr search on enwiki for
keywords extracted from the question, and then considering all sentences
from top N results that contain at least a single such keyword.  Sentences
that match the gold standard answer regex are labelled as 1, the rest is 0.
This *automatic labelling* means the dataset is **quite noisy**.

Several additional features are included:

  * **kwweights** - sum of weights of *non-about* qtext keywords matched in atext
  * **aboutkwweights** - sum of weights of *about* qtext keywords matched in atext,
    that is keywords that also matched the title of the source document
    (the hypothesis being that matching these yields less information)
  * **toklabels** - per-token labels of whether this label is part of the answer

The key metric here is MRR when ranking sentences answering the same question
by their score, but raw accuracy may be also interesting.  The dataset is
heavily unbalanced!  In our models, we subsample 0-entries as well as
supersample 1-entries.  First 80% entries result in the training set, last 20%
is validation set.  The test set is generated from the ``curated-test`` set.

This dataset is subject to change and evolution, hence the ``v2``.

Moreover, an extended dataset which is probably even more noisy (as the
questions haven't been so carefully curated, and gold standard regexes not
so carefully reviewed either) but about 3-4 times bigger is available as
``large2470``.  The splits of this dataset are supersets of the ``curated``
dataset.

TODO: Figure out whether it's better to report final results on the large2470
or curated test split.

Model Comparison
----------------

For randomized models, 95% confidence intervals (t-distribution) are reported.

The f_add_kw versions are ensembles of raw neural networks with yodaqakw scores.
We'll also shortly report BM25 ensemble results.  The new way to write this option
is ``f_add=['kw', 'akw']``.

curatedv2:

| Model                    | trainAllMRR | devMRR   | testMAP  | testMRR  | settings
|--------------------------|-------------|----------|----------|----------|---------
| yodaqakw                 | 0.368773    | 0.337348 | 0.284100 | 0.383238 | (defaults)
| termfreq TF-IDF #w       | 0.339544    | 0.324693 | 0.242700 | 0.337893 | ``freq_mode='tf'``
| termfreq BM25 #w         | 0.483538    | 0.452647 | 0.294300 | 0.484530 | (defaults)
|--------------------------|-------------|----------|----------|----------|---------
| avg                      | 0.422881    | 0.402618 | 0.229694 | 0.329356 | (defaults)
|                          |±0.024685    |±0.006664 |±0.001715 |±0.003511 |
| DAN                      | 0.437119    | 0.430754 | 0.233000 | 0.354075 | ``inp_e_dropout=0`` ``inp_w_dropout=1/3`` ``deep=2`` ``pact='relu'``
|                          |±0.014494    |±0.014477 |±0.002657 |±0.010307 |
|--------------------------|-------------|----------|----------|----------|---------
| rnn                      | 0.459869    | 0.429780 | 0.228869 | 0.341706 | (defaults)
|                          |±0.035981    |±0.015609 |±0.005554 |±0.010643 |
| cnn                      | 0.544067    | 0.363028 | 0.228538 | 0.309165 | (defaults)
|                          |±0.037730    |±0.011041 |±0.004791 |±0.009649 |
| rnncnn                   | 0.578608    | 0.374195 | 0.238200 | 0.344659 | (defaults)
|                          |±0.044228    |±0.023533 |±0.007741 |±0.014747 |
| attn1511                 | 0.432403    | 0.475125 | 0.275219 | 0.468555 | (defaults)
|                          |±0.016183    |±0.012810 |±0.006562 |±0.014433 |
|--------------------------|-------------|----------|----------|----------|---------
| rnn                      | 0.600532    | 0.493167 | 0.300700 | 0.463808 | Ubuntu transfer learning (``ptscorer=B.dot_ptscorer`` ``pdim=1`` ``inp_e_dropout=0`` ``dropout=0`` ``balance_class=True`` ``adapt_ubuntu=True`` ``vocabt='ubuntu'`` ``opt='rmsprop'``)
|                          |±0.045585    |±0.015647 |±0.007871 |±0.011789 |
|--------------------------|-------------|----------|----------|----------|---------
| avg                      | 0.487246    | 0.451062 | 0.250563 | 0.370919 | ``f_add_kw=True``
|                          |±0.046523    |±0.007836 |±0.005624 |±0.008380 |
| DAN                      | 0.492934    | 0.483218 | 0.279650 | 0.441829 | ``inp_e_dropout=0`` ``inp_w_dropout=1/3`` ``deep=2`` ``pact='relu'`` ``f_add_kw=True``
|                          |±0.037740    |±0.007931 |±0.004544 |±0.009156 |
| rnn                      | 0.488602    | 0.469423 | 0.255750 | 0.403185 | ``f_add_kw=True``
|                          |±0.030025    |±0.013534 |±0.005382 |±0.010489 |
| cnn                      | 0.572758    | 0.410014 | 0.248494 | 0.350063 | ``f_add_kw=True``
|                          |±0.025883    |±0.012990 |±0.005084 |±0.010683 |
| rnncnn                   | 0.555559    | 0.419693 | 0.259669 | 0.386323 | ``f_add_kw=True``
|                          |±0.035131    |±0.019007 |±0.005742 |±0.015534 |
| attn1511                 | 0.475656    | 0.485543 | 0.299025 | 0.473519 | ``f_add_kw=True``
|                          |±0.014700    |±0.008612 |±0.004635 |±0.004926 |

These results are obtained like this:

	tools/train.py avg anssel data/anssel/yodaqa/curatedv2-training.csv data/anssel/yodaqa/curatedv2-val.csv nb_runs=16
	tools/eval.py avg anssel data/anssel/yodaqa/curatedv2-training.csv data/anssel/yodaqa/curatedv2-val.csv data/anssel/yodaqa/curatedv2-test.csv weights-anssel-avg--69489c8dc3b6ce11-*-bestval.h5

large2470:

| Model                    | trainAllMRR | devMRR   | testMAP  | testMRR  | settings
|--------------------------|-------------|----------|----------|----------|---------
| yodaqakw                 | 0.332693    | 0.318246 | 0.303900 | 0.376465 | (defaults)
| termfreq TF-IDF #w       | 0.325390    | 0.328255 | 0.266800 | 0.362613 | ``freq_mode='tf'``
| termfreq BM25 #w         | 0.441573    | 0.432115 | 0.313900 | 0.490822 | (defaults)
|--------------------------|-------------|----------|----------|----------|---------
| avg                      | 0.798883    | 0.408034 | 0.262569 | 0.362190 | (defaults)
|                          |±0.026554    |±0.004656 |±0.002054 |±0.005725 |
| DAN                      | 0.646481    | 0.404210 | 0.272675 | 0.386522 | ``inp_e_dropout=0`` ``inp_w_dropout=1/3`` ``deep=2`` ``pact='relu'``
|                          |±0.070994    |±0.005378 |±0.003028 |±0.007627 |
|--------------------------|-------------|----------|----------|----------|---------
| rnn                      | 0.460984    | 0.382949 | 0.262463 | 0.381298 | (defaults)
|                          |±0.023715    |±0.006451 |±0.002641 |±0.007643 |
| cnn                      | 0.550441    | 0.348247 | 0.264476 | 0.353243 | (defaults)
|                          |±0.069701    |±0.006217 |±0.002918 |±0.009620 |
| rnncnn                   | 0.681908    | 0.408662 | 0.286118 | 0.394865 | (defaults)
|                          |±0.114967    |±0.008659 |±0.003501 |±0.011895 |
| attn1511                 | 0.445635    | 0.408495 | 0.288100 | 0.430892 | (defaults)
|                          |±0.056352    |±0.008744 |±0.005601 |±0.017858 |
|--------------------------|-------------|----------|----------|----------|---------
| rnn                      | 0.623209    | 0.517763 | 0.359331 | 0.539284 | Ubuntu transfer learning (``ptscorer=B.dot_ptscorer`` ``pdim=1`` ``inp_e_dropout=0`` ``dropout=0`` ``balance_class=True`` ``adapt_ubuntu=True`` ``opt='rmsprop'``)
|                          |±0.014351    |±0.007724 |±0.003003 |±0.005755 |
|--------------------------|-------------|----------|----------|----------|---------
| avg                      | 0.647144    | 0.420943 | 0.289044 | 0.419559 | ``f_add_kw=True``
|                          |±0.068187    |±0.004745 |±0.002541 |±0.011235 |
| DAN                      | 0.578884    | 0.454751 | 0.316606 | 0.472173 | ``inp_e_dropout=0`` ``inp_w_dropout=1/3`` ``deep=2`` ``pact='relu'`` ``f_add_kw=True``
|                          |±0.051564    |±0.005778 |±0.004260 |±0.006205 |
| rnn                      | 0.471287    | 0.423417 | 0.296419 | 0.446478 | ``f_add_kw=True``
|                          |±0.021866    |±0.007853 |±0.005486 |±0.011307 |
| cnn                      | 0.532295    | 0.375244 | 0.285288 | 0.398820 | ``f_add_kw=True``
|                          |±0.052085    |±0.006402 |±0.002901 |±0.009145 |
| rnncnn                   | 0.595107    | 0.430172 | 0.308475 | 0.444440 | ``f_add_kw=True``
|                          |±0.091860    |±0.010868 |±0.005538 |±0.013976 |
| attn1511                 | 0.488763    | 0.455023 | 0.330781 | 0.492604 | ``f_add_kw=True``
|                          |±0.015243    |±0.006933 |±0.002899 |±0.005126 |

These results are obtained like this:

	tools/train.py avg anssel data/anssel/yodaqa/large2470-training.csv data/anssel/yodaqa/large2470-val.csv nb_runs=16
	tools/eval.py avg anssel data/anssel/yodaqa/large2470-training.csv data/anssel/yodaqa/large2470-val.csv data/anssel/yodaqa/large2470-test.csv weights-anssel-avg--69489c8dc3b6ce11-*-bestval.h5

Transfer learning has been performed like this:

	tools/transfer.py rnn ubuntu data/anssel/ubuntu/v2-vocab.pickle ubu-weights-rnn--23fa2eff7cda310d-bestval.h5 anssel data/anssel/yodaqa/curatedv2-training.csv data/anssel/yodaqa/curatedv2-val.csv pdim=1 ptscorer=B.dot_ptscorer dropout=0 inp_e_dropout=0 balance_class=True adapt_ubuntu=True "opt='rmsprop'" nb_runs=16
	tools/eval.py rnn anssel data/anssel/yodaqa/curatedv2-training.csv data/anssel/yodaqa/curatedv2-val.csv data/anssel/yodaqa/curatedv2-test.csv weights-ubuntu-anssel-rnn-1cd9ebbf9c99f926-*-bestval.h5 "vocabf='data/anssel/ubuntu/v2-vocab.pickle'" "vocabt='ubuntu'" pdim=1 ptscorer=B.dot_ptscorer inp_e_dropout=0 dropout=0 balance_class=True adapt_ubuntu=True "opt='rmsprop'"

where the ubu-weights model can be downloaded from

	http://pasky.or.cz/dev/brmson/ubu-weights-rnn--23fa2eff7cda310d-bestval.h5


Older Datasets
--------------

The academic standard up to now stems from **anssel/wang** - the TREC-based
dataset originally by Wang et al., 2007, in the form by Yao et al., 2013.
However, this dataset seems to be quite easy as the ratio of relevant snippets
is high and they are often pretty short.

That's why we are introducing a new one, which is also somewhat bigger.

See also the WikiQA corpus, which has too restrictive licence but manually
labelled pairs.

Licence
-------

Derived from the ``curated-train`` YodaQA dataset

	htts://github.com/brmson/dataset-factoid-curated

and sentences from Wikipedia, Wikipedia is CC-BY-SA if that's relevant.
